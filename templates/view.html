<!doctype html>
<html lang="en">
  <head>
    <title>Ultimate Comics</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Required libs -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
	
    <!-- Functions -->
	<script>
	$(document).ready(function(){
	
	    $("#random").click(function(){
	        retrieveComic("random", $("#comic").parent().attr('id'));
	    });

	    $("#previous").click(function(){
	        retrieveComic("previous", $("#comic").parent().attr('id'));
	    });

	    $("#next").click(function(){
	        retrieveComic("next", $("#comic").parent().attr('id'));
	    });
	});

	function update_document(json_response){
		// Taking the new values to update the page
		var new_id = json_response["id"];
	    var new_title = json_response["title"];
	    var new_image_link = json_response["image_link"];
	    var new_image_alt = json_response["image_alt"];
	    var new_original_url = json_response["original_url"];

	    // Chaning correspondent elements
	    $("#comic").parent().prop('id', new_id);
	    document.getElementById("comic").textContent=new_title;
	    $("#image").prop("src",new_image_link);
	    $("#image").prop("alt",new_image_alt);
	    $("#original_url").prop("href",new_original_url);
	    document.getElementById("original_url").textContent= original_url;
	}

	function retrieveComic(action_taken, current_comic_id){
			var parameters = {
				mode: action_taken,
				id: current_comic_id
			};
	    	$.ajax({
	            url: '/retrieve_comic/',
	            data: JSON.stringify(parameters),
	            type: "POST",
	            success: function(response) {
	            	json_response =JSON.parse(response);
	            	update_document(json_response);
	            },
	            error: function(error) {
	                console.log(error);
	            }
        	});
	    }

	</script>

  </head>

  <body style="background-color: #f0f5fc;padding:30px">

  	<div class="container-fluid">

	  	<center>

	  	<!-- Header Information -->
	  	<header>
	    	<h1>Welcome to Ultimate Comics!</h1><hr>
	    	<p>Retrieved from: <a href="https://xkcd.com/">https://xkcd.com/ </a> </p>
	  	</header>

	  	
	  	<div id="{{data.id}}">

		<!--Comic Info-->
		
		<h3 id="comic"> {{data.title}} </h3>
		<img id="image" src="{{data.image_link}}" alt={{data.image_alt}}/>
		<br>
		<p style="padding:20px">Original Reference: <a id="original_url" href= {{data.original_url}}> {{data.original_url}} </a> </p>
		
		<!--End of Comic Info-->

		<!--- Buttons -->
		<button type="button" id="previous" class="btn btn-outline-success">Previous</button>
		<button type="button" id="random" class="btn btn-outline-primary"">Random</button>
		<button type="button" id="next" class="btn btn-outline-success">Next</button>
	    
		</div>

		</center>
	</div>
	<script type=text/javascript src="{{ url_for('static', filename='js/jquery.js') }}"></script>
  </body>
</html>